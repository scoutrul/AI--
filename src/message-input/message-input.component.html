<footer class="bg-white dark:bg-gray-900 p-4 shadow-t-md">
  <div class="max-w-4xl mx-auto">
    <div class="bg-gray-50 dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-xl focus-within:ring-2 focus-within:ring-blue-500 transition-shadow flex items-end space-x-2 p-2">
      <!-- Prompt Suggestion Button -->
      <button 
        (click)="suggestPrompt()" 
        [disabled]="isLoading() || isRecording()"
        title="Предложить идею" 
        class="p-3 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 disabled:opacity-50 transition-colors focus:outline-none self-end">
         <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
          </svg>
      </button>

      <textarea 
        #userInputArea
        class="flex-1 p-3 bg-transparent focus:outline-none resize-none min-h-12 max-h-36 text-base"
        rows="1"
        placeholder="Напишите сообщение..."
        [(ngModel)]="userInput"
        (keydown)="handleKeyDown($event)"
        [disabled]="isLoading() || isRecording()">
      </textarea>
      
      @if(speechApiSupported()) {
        <button 
          (click)="recordingToggled.emit()" 
          [disabled]="isLoading()"
          [class.bg-red-500]="isRecording()"
          [class.hover:bg-red-600]="isRecording()"
          [class.bg-blue-500]="!isRecording()"
          [class.hover:bg-blue-600]="!isRecording()"
          title="Записать голосовое сообщение"
          class="text-white rounded-full p-3 focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-900 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors self-end">
            @if(isRecording()){
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor"><path d="M12 18a6 6 0 1 0 0-12 6 6 0 0 0 0 12Z"/></svg>
            } @else {
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
              </svg>
            }
        </button>
      }
      <button 
        (click)="sendMessage()" 
        [disabled]="isLoading() || userInput().trim() === '' || isRecording()"
        class="bg-blue-500 text-white rounded-full p-3 hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-900 disabled:bg-blue-300 disabled:cursor-not-allowed transition-colors self-end">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor">
            <path d="M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z" />
          </svg>
      </button>
    </div>
  </div>
</footer>